"use strict";const assetsPath="assets/stardew/",storageKey="stardew-combos",shedWidth=390,shedHeight=437,previewArea=document.getElementById("preview-area"),previewCanvas=document.getElementById("preview-canvas"),saveButton=document.getElementById("save-button"),unsaveButton=document.getElementById("unsave-button"),wallpaperContents=document.getElementById("wallpaper-contents"),flooringContents=document.getElementById("flooring-contents"),combosContents=document.getElementById("combos-contents");let selectedWallpaper=void 0,selectedFlooring=void 0,combos=[],images=Object.create(null),imageDataCache=Object.create(null);function setup(){let e=[];previewCanvas.width=390,previewCanvas.height=437,saveButton.addEventListener("click",()=>{saveCombo(selectedWallpaper,selectedFlooring)}),unsaveButton.addEventListener("click",()=>{unsaveCombo(selectedWallpaper,selectedFlooring)});let t=document.createElement("img");t.src=assetsPath+"Shed_Inside.png",t.style.display="none",previewArea.appendChild(t),e.push(imageLoadPromise(t)),images["background/shed"]=t;let a=setupWallpaperChoices(wallpaperContents);e=e.concat(a);let o=setupFlooringChoices(flooringContents);e=e.concat(o),Promise.all(e).then(()=>{loadCombosFromStorage(),select("001","01"),drawShed(),document.body.classList.remove("is-loading"),centerPreview()})}function setupWallpaperChoices(e){let t=[];for(let a=1;a<=112;a++){let o=a.toString();o="0".repeat(3-o.length)+o;let l=document.createElement("button");l.id="wallpaper-"+o,l.classList.add("wallpaper-choice"),l.addEventListener("click",()=>{select(o,null),drawShed()}),l.addEventListener("mouseenter",()=>{drawShed(o,void 0)}),l.addEventListener("mouseleave",()=>{drawShed()}),e.appendChild(l);let n=document.createElement("img");n.classList.add("wallpaper-icon"),n.src=assetsPath+"Wallpaper_000_Icon.png".replace("000",o),l.appendChild(n);let s=document.createElement("img");s.src=assetsPath+"Wallpaper_000.png".replace("000",o),s.style.display="none",l.appendChild(s),t.push(imageLoadPromise(n)),t.push(imageLoadPromise(s)),images["wallpaper/icon/"+o]=n,images["wallpaper/"+o]=s}return t}function setupFlooringChoices(e){let t=[];for(let a=1;a<=56;a++){let o=a.toString();o="0".repeat(2-o.length)+o;let l=document.createElement("button");l.id="flooring-"+o,l.classList.add("flooring-choice"),l.addEventListener("click",()=>{select(null,o),drawShed()}),l.addEventListener("mouseenter",()=>{drawShed(void 0,o)}),l.addEventListener("mouseleave",()=>{drawShed()}),e.appendChild(l);let n=document.createElement("img");n.classList.add("flooring-icon"),n.src=assetsPath+"Flooring_00_Icon.png".replace("00",o),l.appendChild(n);let s=document.createElement("img");s.src=assetsPath+"Flooring_00.png".replace("00",o),s.style.display="none",l.appendChild(s),t.push(imageLoadPromise(n)),t.push(imageLoadPromise(s)),images["flooring/icon/"+o]=n,images["flooring/"+o]=s}return t}function drawShed(e=selectedWallpaper,t=selectedFlooring){let a=previewCanvas.getContext("2d");a.drawImage(images["background/shed"],0,0,390,437),a.save(),drawFlooring(a,t),a.restore(),a.save(),drawWallpaper(a,e),a.restore()}function drawWallpaper(e,t){e.beginPath(),e.moveTo(19,20),e.lineTo(19,116),e.lineTo(371,116),e.lineTo(371,20),e.clip();let a=images["wallpaper/"+t];for(var o=0;o<=3;o++)e.drawImage(a,19+96*o,20)}function drawFlooring(e,t){e.beginPath(),e.moveTo(19,110),e.lineTo(19,376),e.lineTo(32,388),e.lineTo(177,388),e.lineTo(179,390),e.lineTo(179,420),e.lineTo(211,420),e.lineTo(211,390),e.lineTo(213,388),e.lineTo(358,388),e.lineTo(371,376),e.lineTo(371,110),e.clip();let a=images["flooring/"+t];for(var o=0;o<=4;o++)for(var l=0;l<=3;l++)e.drawImage(a,19+128*o,20+128*l)}function select(e,t){let a=document.getElementById(`combos-${selectedWallpaper}-${selectedFlooring}`);null!=a&&a.classList.remove("selected");let o=document.getElementById("wallpaper-"+selectedWallpaper);null!=o&&o.classList.remove("selected");let l=document.getElementById("flooring-"+selectedFlooring);null!=l&&l.classList.remove("selected"),null!=e&&(selectedWallpaper=e),document.getElementById("wallpaper-"+selectedWallpaper).classList.add("selected"),null!=t&&(selectedFlooring=t),document.getElementById("flooring-"+selectedFlooring).classList.add("selected");let n=document.getElementById(`combos-${selectedWallpaper}-${selectedFlooring}`),s=null!=n;s&&n.classList.add("selected"),saveButton.style.display=s?"none":"",unsaveButton.style.display=s?"":"none"}function saveCombo(e,t){let a=document.createElement("button");a.id=`combos-${e}-${t}`,a.classList.add("combos-choice"),a.addEventListener("click",()=>{select(e,t),drawShed()}),a.addEventListener("mouseenter",()=>{drawShed(e,t)}),a.addEventListener("mouseleave",()=>{drawShed()}),combosContents.appendChild(a);let o=document.createElement("img");o.classList.add("wallpaper-icon"),o.src=getImageData(images["wallpaper/icon/"+e]),a.appendChild(o);let l=document.createElement("img");l.classList.add("flooring-icon"),l.src=getImageData(images["flooring/icon/"+t]),a.appendChild(l),combos.push({wallpaper:e,flooring:t}),saveCombosToStorage(),select(null,null)}function unsaveCombo(e,t){combosContents.removeChild(document.getElementById(`combos-${e}-${t}`));let a=combos.findIndex(a=>a.wallpaper==e&&a.flooring==t);combos.splice(a,1),saveCombosToStorage(),select(null,null)}function loadCombosFromStorage(){try{combos=JSON.parse(localStorage.getItem(storageKey))}catch{}null==combos&&(combos=[]);for(let e of combos){let t=document.createElement("button");t.id=`combos-${e.wallpaper}-${e.flooring}`,t.classList.add("combos-choice"),t.addEventListener("click",()=>{select(e.wallpaper,e.flooring),drawShed()}),t.addEventListener("mouseenter",()=>{drawShed(e.wallpaper,e.flooring)}),t.addEventListener("mouseleave",()=>{drawShed()}),combosContents.appendChild(t);let a=document.createElement("img");a.classList.add("wallpaper-icon"),a.src=getImageData(images["wallpaper/icon/"+e.wallpaper]),t.appendChild(a);let o=document.createElement("img");o.classList.add("flooring-icon"),o.src=getImageData(images["flooring/icon/"+e.flooring]),t.appendChild(o)}}function saveCombosToStorage(){try{localStorage.setItem(storageKey,JSON.stringify(combos))}catch{}}function imageLoadPromise(e){return new Promise((t,a)=>{e.addEventListener("load",()=>{t()}),e.addEventListener("error",()=>{a()})})}function getImageData(e){let t=e.src;if("file:"===location.protocol)return t;if(!(t in imageDataCache)){let a=document.createElement("canvas");a.width=e.naturalWidth,a.height=e.naturalHeight,a.getContext("2d").drawImage(e,0,0),imageDataCache[t]=a.toDataURL()}return imageDataCache[t]}function centerPreview(){if(window.innerWidth<720)return void(previewArea.style.top="");let e=(window.innerHeight-previewArea.getBoundingClientRect().height)/3;e=Math.max(e,-16),e=Math.round(e),previewArea.style.top=e+"px"}function main(){setup(),window.addEventListener("resize",centerPreview)}main();